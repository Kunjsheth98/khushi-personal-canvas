<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Khushi Mode</title>

<style>
body{
  margin:0;
  font-family: system-ui, sans-serif;
  background: linear-gradient(135deg,#f5e9ff,#ffffff);
  text-align:center;
  padding:14px;
}
h1{color:#6b21a8;margin:6px 0;}
#dayText{font-size:13px;color:#555;}
#modeDisplay{
  margin:6px 0 10px;
  font-size:14px;
  font-weight:600;
  color:#7c3aed;
}
#prompt{
  font-size:14px;
  margin-bottom:12px;
  color:#444;
}

.bar{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:10px;
  margin-bottom:10px;
}

button, select, input{
  padding:10px 14px;
  border-radius:18px;
  border:none;
  background:#ede9fe;
  font-size:14px;
  cursor:pointer;
}

canvas{
  background:#fff;
  border-radius:26px;
  display:block;
  margin:14px auto;
  width:96vw;
  max-width:520px;
  height:96vw;
  max-height:520px;
  touch-action:none;
  box-shadow:0 10px 28px rgba(0,0,0,0.08);
}

/* GALLERY */
#gallery{
  display:flex;
  gap:10px;
  overflow-x:auto;
  padding:10px;
  justify-content:flex-start;
}
#gallery img{
  width:90px;
  height:90px;
  border-radius:16px;
  cursor:pointer;
  box-shadow:0 4px 14px rgba(0,0,0,0.12);
}
</style>
</head>

<body>

<h1>KHUSHI MODE</h1>
<div id="dayText"></div>
<div id="modeDisplay">Mode: Paint</div>
<div id="prompt"></div>

<!-- MODE BAR -->
<div class="bar">
  <button onclick="setMode('paint')">üé® Paint</button>
  <button onclick="setMode('mandala')">üåÄ Mandala</button>
  <button onclick="setMode('doodle')">‚úèÔ∏è Doodle</button>
  <button onclick="setMode('wave')">üåä Wave</button>
  <button onclick="setMode('orbit')">üß¨ Orbit</button>
  <button onclick="setMode('breathe')">üå¨Ô∏è Breathe</button>
</div>

<!-- TOOL BAR -->
<div class="bar">
  <input type="color" id="color1" value="#8b5cf6">
  <input type="color" id="color2" value="#ec4899">
  <button onclick="toggleGradient()">üåà Gradient</button>
  <input type="range" id="sizeSlider" min="6" max="50" value="24">
</div>

<!-- STYLE BAR -->
<div class="bar">
  <select id="mandalaSelect">
    <option value="classic">Mandala: Classic</option>
    <option value="flower">Flower</option>
    <option value="spiral">Spiral</option>
    <option value="kaleido">Kaleidoscope</option>
  </select>

  <select id="doodleSelect">
    <option value="ribbon">Doodle: Ribbon</option>
    <option value="infinity">Infinity</option>
    <option value="leaf">Leaf</option>
    <option value="zen">Zen Dots</option>
  </select>
</div>

<canvas id="canvas" width="520" height="520"></canvas>

<!-- ACTION BAR -->
<div class="bar">
  <button onclick="undo()">‚Ü© Undo</button>
  <button onclick="toggleMusic()">üéµ Music</button>
  <button onclick="resetCanvas()">‚ôªÔ∏è Reset</button>
  <button onclick="saveArt()">üíæ Save</button>
</div>

<!-- GALLERY -->
<div id="gallery"></div>

<audio id="bgMusic" loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
/* DAY + PROMPT */
const start=new Date("2024-01-01");
dayText.innerText=`Day ${Math.floor((new Date()-start)/(1000*60*60*24))+1} ‚Äî Welcome back`;

const prompts=[
 "Draw how calm feels today.",
 "Create something soft and kind.",
 "Let your lines breathe slowly.",
 "Draw without planning.",
 "Make something only you understand.",
 "Draw peace, not perfection."
];
prompt.innerText="üñåÔ∏è Today‚Äôs prompt: "+prompts[new Date().getDate()%prompts.length];

/* STATE */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

let drawing=false;
let mode="paint";
let history=[];

let useGradient=true;
const color1=document.getElementById("color1");
const color2=document.getElementById("color2");
const sizeSlider=document.getElementById("sizeSlider");

const mandalaSelect=document.getElementById("mandalaSelect");
const doodleSelect=document.getElementById("doodleSelect");

let breathPhase=0;

/* EVENTS */
canvas.addEventListener("mousedown",startDraw);
canvas.addEventListener("mousemove",draw);
canvas.addEventListener("mouseup",()=>drawing=false);
canvas.addEventListener("touchstart",startDraw,{passive:false});
canvas.addEventListener("touchmove",draw,{passive:false});
canvas.addEventListener("touchend",()=>drawing=false);

function setMode(m){
  mode=m;
  modeDisplay.innerText="Mode: "+m.charAt(0).toUpperCase()+m.slice(1);
}

function toggleGradient(){
  useGradient=!useGradient;
}

function startDraw(e){
  drawing=true;
  history.push(canvas.toDataURL());
  draw(e);
}

function draw(e){
  if(!drawing) return;
  const r=canvas.getBoundingClientRect();
  const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left;
  const y=(e.touches?e.touches[0].clientY:e.clientY)-r.top;

  if(mode==="paint") paint(x,y);
  if(mode==="mandala") mandala(x,y);
  if(mode==="doodle") doodle(x,y);
  if(mode==="wave") wave(x,y);
  if(mode==="orbit") orbit(x,y);
  if(mode==="breathe") breathe(x,y);
}

function brushFill(x,y){
  if(!useGradient) return color1.value;
  const g=ctx.createLinearGradient(
    x-sizeSlider.value,
    y-sizeSlider.value,
    x+sizeSlider.value,
    y+sizeSlider.value
  );
  g.addColorStop(0,color1.value);
  g.addColorStop(1,color2.value);
  return g;
}

function paint(x,y){
  ctx.fillStyle=brushFill(x,y);
  ctx.beginPath();
  ctx.arc(x,y,sizeSlider.value,0,Math.PI*2);
  ctx.fill();
}

/* MANDALA */
function mandala(x,y){
  const cx=canvas.width/2, cy=canvas.height/2;
  const dx=x-cx, dy=y-cy;
  const points=12;
  for(let i=0;i<points;i++){
    const a=2*Math.PI/points*i;
    paint(
      cx+dx*Math.cos(a)-dy*Math.sin(a),
      cy+dx*Math.sin(a)+dy*Math.cos(a)
    );
  }
}

/* DOODLE */
function doodle(x,y){
  ctx.strokeStyle=brushFill(x,y);
  ctx.lineWidth=3;
  ctx.beginPath();
  const type=doodleSelect.value;
  if(type==="ribbon") ctx.quadraticCurveTo(x,y-sizeSlider.value,x+sizeSlider.value,y);
  if(type==="infinity") ctx.bezierCurveTo(x-sizeSlider.value,y,x,y-sizeSlider.value,x+sizeSlider.value,y);
  if(type==="leaf") ctx.ellipse(x,y,sizeSlider.value,sizeSlider.value/2,Math.random(),0,Math.PI*2);
  if(type==="zen") ctx.arc(x,y,sizeSlider.value/3,0,Math.PI*2);
  ctx.stroke();
}

/* OTHER ARTS */
function wave(x,y){
  ctx.strokeStyle=brushFill(x,y);
  ctx.beginPath();
  ctx.moveTo(x-sizeSlider.value,y);
  ctx.quadraticCurveTo(x,y+sizeSlider.value,x+sizeSlider.value,y);
  ctx.stroke();
}

function orbit(x,y){
  for(let i=0;i<6;i++){
    ctx.fillStyle=brushFill(x,y);
    ctx.beginPath();
    ctx.arc(
      x+Math.cos(i)*sizeSlider.value,
      y+Math.sin(i)*sizeSlider.value,
      4,0,Math.PI*2
    );
    ctx.fill();
  }
}

function breathe(x,y){
  breathPhase+=0.05;
  const b=sizeSlider.value+(Math.sin(breathPhase)*10);
  ctx.fillStyle=brushFill(x,y);
  ctx.beginPath();
  ctx.arc(x,y,b,0,Math.PI*2);
  ctx.fill();
}

/* ACTIONS */
function undo(){
  if(!history.length) return;
  const img=new Image();
  img.src=history.pop();
  img.onload=()=>ctx.drawImage(img,0,0);
}

const music=document.getElementById("bgMusic");
let playing=false;
function toggleMusic(){
  playing ? music.pause() : music.play();
  playing=!playing;
}

function resetCanvas(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  history=[];
}

/* SAVE + GALLERY */
function saveArt(){
  const data=canvas.toDataURL("image/png");
  addToGallery(data);

  let saved=JSON.parse(localStorage.getItem("khushiGallery")||"[]");
  saved.unshift(data);
  localStorage.setItem("khushiGallery",JSON.stringify(saved));
}

function addToGallery(data){
  const img=document.createElement("img");
  img.src=data;
  img.onclick=()=>window.open(data,"_blank");
  document.getElementById("gallery").prepend(img);
}

/* LOAD GALLERY */
window.onload=()=>{
  const saved=JSON.parse(localStorage.getItem("khushiGallery")||"[]");
  saved.forEach(addToGallery);
};
</script>

</body>
</html>
