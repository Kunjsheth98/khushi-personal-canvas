<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Khushi Mode Pro</title>

<style>
body{
margin:0;
font-family:system-ui;
background:linear-gradient(135deg,#f3e8ff,#ffffff);
text-align:center;
padding:14px;
transition:0.3s;
}
h1{color:#6d28d9;margin:6px;}
#modeDisplay{font-weight:600;color:#7c3aed;margin-bottom:8px;}

.bar{
display:flex;
flex-wrap:wrap;
justify-content:center;
gap:8px;
margin-bottom:10px;
}

button{
padding:8px 14px;
border-radius:18px;
border:none;
background:#ede9fe;
cursor:pointer;
font-size:13px;
transition:0.2s;
}
button.active{
background:#c4b5fd;
}

canvas{
background:#fff;
border-radius:24px;
box-shadow:0 10px 28px rgba(0,0,0,0.08);
display:block;
margin:12px auto;
touch-action:none;
}

#gallery{
display:flex;
gap:8px;
overflow-x:auto;
padding:8px;
}
#gallery img{
width:80px;
height:80px;
border-radius:14px;
cursor:pointer;
}
</style>
</head>
<body>

<h1>KHUSHI MODE</h1>
<div id="modeDisplay">Mode: Paint</div>

<div class="bar" id="modeBar"></div>
<div class="bar" id="styleBar"></div>

<div class="bar">
<input type="color" id="c1" value="#8b5cf6">
<input type="color" id="c2" value="#ec4899">
<button onclick="toggleGradient()">Gradient</button>
<input type="range" id="size" min="4" max="50" value="16">
<input type="range" id="symmetry" min="4" max="24" value="12">
</div>

<div class="bar">
<select onchange="setTheme(this.value)">
<option value="lavender">Lavender Glow</option>
<option value="peach">Soft Peach</option>
<option value="white">Clean White</option>
<option value="night">Night Calm</option>
<option value="studio">Studio Gray</option>
</select>
</div>

<canvas id="canvas"></canvas>

<div class="bar">
<button onclick="undo()">Undo</button>
<button onclick="resetCanvas()">Reset</button>
<button onclick="saveArt()">Save</button>
<button onclick="exportSticker()">Sticker</button>
</div>

<div id="gallery"></div>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

function resize(){
let s=Math.min(window.innerWidth*0.9,520);
canvas.width=s;
canvas.height=s;
}
resize();
window.addEventListener("resize",resize);

let drawing=false;
let currentMode="paint";
let currentStyle="";
let gradient=true;
let history=[];
let teddyStep=0;

const c1=document.getElementById("c1");
const c2=document.getElementById("c2");
const sizeSlider=document.getElementById("size");
const symmetrySlider=document.getElementById("symmetry");

const modes={
paint:["Soft","Glow"],
mandala:["Classic","Flower","Dots"],
doodle:["Infinity","Zen"],
galaxy:["Spiral","Dust","Burst"],
teddy:["Classic","Chubby","Panda","Pastel","Sleepy"]
};

function buildUI(){
const mb=document.getElementById("modeBar");
mb.innerHTML="";
Object.keys(modes).forEach(m=>{
let b=document.createElement("button");
b.innerText=m;
b.onclick=()=>setMode(m);
if(m===currentMode)b.classList.add("active");
mb.appendChild(b);
});
buildStyles();
}

function buildStyles(){
const sb=document.getElementById("styleBar");
sb.innerHTML="";
modes[currentMode].forEach(s=>{
let b=document.createElement("button");
b.innerText=s;
b.onclick=()=>setStyle(s);
if(s===currentStyle)b.classList.add("active");
sb.appendChild(b);
});
}

function setMode(m){
currentMode=m;
currentStyle=modes[m][0];
modeDisplay.innerText="Mode: "+m;
buildUI();
}

function setStyle(s){
currentStyle=s;
buildStyles();
}

buildUI();

function toggleGradient(){gradient=!gradient;}

function brush(x,y){
if(!gradient)return c1.value;
let g=ctx.createLinearGradient(x-20,y-20,x+20,y+20);
g.addColorStop(0,c1.value);
g.addColorStop(1,c2.value);
return g;
}

function pos(e){
let r=canvas.getBoundingClientRect();
return{
x:(e.touches?e.touches[0].clientX:e.clientX)-r.left,
y:(e.touches?e.touches[0].clientY:e.clientY)-r.top
};
}

canvas.addEventListener("mousedown",e=>{drawing=true;history.push(canvas.toDataURL());draw(e);});
canvas.addEventListener("mousemove",draw);
canvas.addEventListener("mouseup",()=>drawing=false);
canvas.addEventListener("touchstart",e=>{drawing=true;history.push(canvas.toDataURL());draw(e);},{passive:false});
canvas.addEventListener("touchmove",draw,{passive:false});
canvas.addEventListener("touchend",()=>drawing=false);

function draw(e){
if(!drawing)return;
let {x,y}=pos(e);
ctx.fillStyle=brush(x,y);

if(currentMode==="paint"){
ctx.beginPath();
ctx.arc(x,y,sizeSlider.value,0,Math.PI*2);
ctx.fill();
}

if(currentMode==="mandala"){
let cx=canvas.width/2,cy=canvas.height/2;
let dx=x-cx,dy=y-cy;
let seg=symmetrySlider.value;
for(let i=0;i<seg;i++){
let a=2*Math.PI/seg*i;
let px=cx+dx*Math.cos(a)-dy*Math.sin(a);
let py=cy+dx*Math.sin(a)+dy*Math.cos(a);
ctx.beginPath();
if(currentStyle==="Classic")
ctx.arc(px,py,5,0,Math.PI*2);
if(currentStyle==="Flower")
ctx.ellipse(px,py,18,8,a,0,Math.PI*2);
if(currentStyle==="Dots")
ctx.arc(px,py,3,0,Math.PI*2);
ctx.fill();
}
}

if(currentMode==="galaxy"){
if(currentStyle==="Spiral"){
for(let i=0;i<6;i++){
ctx.beginPath();
ctx.arc(x+Math.cos(i)*20,y+Math.sin(i)*20,3,0,Math.PI*2);
ctx.fill();
}
}
if(currentStyle==="Dust"){
ctx.beginPath();
ctx.arc(x+Math.random()*10,y+Math.random()*10,2,0,Math.PI*2);
ctx.fill();
}
if(currentStyle==="Burst"){
for(let i=0;i<8;i++){
ctx.beginPath();
ctx.arc(x+Math.random()*30-15,y+Math.random()*30-15,2,0,Math.PI*2);
ctx.fill();
}
}
}

if(currentMode==="teddy"){
drawTeddy(x,y);
}
}

function drawTeddy(x,y){
ctx.fillStyle=currentStyle==="Panda"?"#000":brush(x,y);

if(teddyStep===0){
ctx.beginPath();ctx.arc(x,y,35,0,Math.PI*2);ctx.fill();
}
if(teddyStep===1){
ctx.beginPath();ctx.arc(x-25,y-30,18,0,Math.PI*2);ctx.fill();
ctx.beginPath();ctx.arc(x+25,y-30,18,0,Math.PI*2);ctx.fill();
}
if(teddyStep===2){
ctx.fillStyle="#000";
ctx.beginPath();ctx.arc(x-12,y-5,5,0,Math.PI*2);ctx.fill();
ctx.beginPath();ctx.arc(x+12,y-5,5,0,Math.PI*2);ctx.fill();
}
if(teddyStep===3){
ctx.beginPath();ctx.arc(x,y+8,6,0,Math.PI*2);ctx.fill();
}
teddyStep=(teddyStep+1)%4;
}

function undo(){
if(!history.length)return;
let img=new Image();
img.src=history.pop();
img.onload=()=>ctx.drawImage(img,0,0);
}

function resetCanvas(){
ctx.clearRect(0,0,canvas.width,canvas.height);
history=[];
teddyStep=0;
}

function saveArt(){
let data=canvas.toDataURL();
let img=document.createElement("img");
img.src=data;
img.onclick=()=>window.open(data);
gallery.prepend(img);
}

function exportSticker(){
let link=document.createElement("a");
link.download="sticker.png";
link.href=canvas.toDataURL("image/png");
link.click();
}

function setTheme(t){
if(t==="lavender")document.body.style.background="linear-gradient(135deg,#f3e8ff,#ffffff)";
if(t==="peach")document.body.style.background="linear-gradient(135deg,#ffe4e6,#ffffff)";
if(t==="white")document.body.style.background="#ffffff";
if(t==="night")document.body.style.background="linear-gradient(135deg,#1e1b4b,#312e81)";
if(t==="studio")document.body.style.background="#e5e7eb";
}
</script>

</body>
</html>
